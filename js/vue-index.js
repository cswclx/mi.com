const goodsData =
    [
        [
            {
                "text": "",
                "src": "img/nav-children/xm6.png",
                "title": "小米6",
                "price": "2099元起"
            },
            {
                "text": "现货",
                "src": "img/nav-children/max2_toubu.png",
                "title": "小米Max 2",
                "price": "1699元起"
            },
            {
                "text": "新品",
                "src": "img/nav-children/5x.jpg",
                "title": "小米5x",
                "price": "1299元起"
            },
            {
                "text": "下单立减500",
                "src": "img/nav-children/xiaomiNOTE.jpg",
                "title": "小米Note 2",
                "price": "2799元起"
            },
            {
                "text": "下单立减500",
                "src": "img/nav-children/MIX.jpg",
                "title": "小米MIX",
                "price": "3499元起"
            },
            {
                "text": "下单立减200",
                "src": "img/nav-children/5s.jpg",
                "title": "小米5s",
                "price": "1999元起"
            }
        ],
        [
            {
                "text": "赠米粉卡",
                "src": "img/nav-children/hmn4xtb.jpg",
                "title": "红米Note 4X",
                "price": "999元起"
            },
            {
                "text": "赠米粉卡",
                "src": "img/nav-children/hm4x.jpg",
                "title": "红米4X",
                "price": "666元起"
            },
            {
                "text": "",
                "src": "img/nav-children/hm4.jpg",
                "title": "红米4",
                "price": "799元起"
            }
        ],
        [
            {
                "text": "",
                "src": "img/nav-children/mipad.png",
                "title": "小米平板3 64GB",
                "price": "1499元起"
            },
            {
                "text": "",
                "src": "img/nav-children/bijiben.jpg",
                "title": "小米笔记本Air 12.5",
                "price": "3599元起"
            },
            {
                "text": "新品",
                "src": "img/nav-children/bijiben320.jpg",
                "title": "小米笔记本Air 13.3",
                "price": "4999元起"
            }
        ],
        [
            {
                "text": "超薄旗舰",
                "src": "img/nav-children/xmds_49.png",
                "title": "小米电视4 49英寸",
                "price": "3199元起"
            },
            {
                "text": "超薄旗舰",
                "src": "img/nav-children/xmds_55.png",
                "title": "小米电视4 55英寸",
                "price": "3799元起"
            },
            {
                "text": "新品",
                "src": "img/nav-children/daohang.png",
                "title": "小米电视4A 32英寸",
                "price": "999元起"
            },
            {
                "text": "热卖",
                "src": "img/nav-children/320_43.png",
                "title": "小米电视4A 43英寸",
                "price": "1899元起"
            },
            {
                "text": "热卖",
                "src": "img/nav-children/320_49.png",
                "title": "小米电视4A 49英寸",
                "price": "2199元起"
            },
            {
                "text": "",
                "src": "img/nav-children/70dianshi.png",
                "title": "查看全部",
                "price": "小米电视"
            }
        ],
        [
            {
                "text": "",
                "src": "img/nav-children/mihezi.png",
                "title": "小米盒子3s",
                "price": "299元"
            },
            {
                "text": "",
                "src": "img/nav-children/mihezi.png",
                "title": "小米盒子3c",
                "price": "199元"
            },
            {
                "text": "",
                "src": "img/nav-children/hezi3s.jpg",
                "title": "小米盒子3 增强版",
                "price": "399元"
            },
            {
                "text": "新品",
                "src": "img/nav-children/320x220.png",
                "title": "小米家庭影院",
                "price": "1999元"
            }
        ],
        [
            {
                "text": "大容量",
                "src": "img/nav-children/HD-Pro.png",
                "title": "小米路由器 HD/Pro",
                "price": "499元起"
            },
            {
                "text": "双千兆",
                "src": "img/nav-children/3G.png",
                "title": "小米路由器 3G",
                "price": "249元起"
            },
            {
                "text": "双频",
                "src": "img/nav-children/3C.png",
                "title": "小米路由器 3",
                "price": "199元"
            },
            {
                "text": "包邮",
                "src": "img/nav-children/xmlyq3.png",
                "title": "小米路由器 3C",
                "price": "79元"
            },
            {
                "text": "新品",
                "src": "img/nav-children/dlm01.png",
                "title": "小米WiFi电力猫",
                "price": "199元"
            },
            {
                "text": "",
                "src": "img/nav-children/fdq2.jpg",
                "title": "小米WiFi放大器 2",
                "price": "39元"
            }
        ],
        [
            {
                "text": "航拍利器",
                "src": "img/nav-children/123321.jpg",
                "title": "小米无人机",
                "price": "2999元"
            },
            {
                "text": "包邮",
                "src": "img/nav-children/sh2.png",
                "title": "小米手环2",
                "price": "149元起"
            },
            {
                "text": "",
                "src": "img/nav-children/jsqcs.png",
                "title": "小米净水器",
                "price": "1499元"
            },
            {
                "text": "包邮",
                "src": "img/nav-children/saodijiqiren.jpg",
                "title": "米家扫地机器人",
                "price": "1699元"
            },
            {
                "text": "",
                "src": "img/nav-children/dfb.pg.jpg",
                "title": "米家压力IH电饭煲",
                "price": "999元"
            },
            {
                "text": "",
                "src": "img/nav-children/air2.jpg",
                "title": "查看全部",
                "price": "智能硬件"
            }
        ],
        ["小米手机", "红米", "平板 · 笔记本", "电视", "盒子 · 影音", "路由器", "智能硬件", "服务", "社区"]
    ]



new Vue({
    el: '#site-header',
    data: {
        dataList: [],
        showList: [],
        parentList: [],
        isInChild: false,
        isFocus: false,
        timer: null
    },
    mounted() {
        this.dataList = goodsData
        this.showList = goodsData[0]
        this.parentList = goodsData[goodsData.length - 1]
    },
    methods: {
        parentEnter(e) {
            let index = e.target.getAttribute('data-id')
            if (index <= this.dataList.length - 2) {
                this.showList = this.dataList[index]
                this._closeOrOpen(true)
            } else {
                this._closeOrOpen(false)
            }
        },
        parentLeave() {
            this._closeOrOpen(false)
        },
        _closeOrOpen(isOpen) {
            if(this.timer) {
                clearTimeout(this.timer)
            }
            let height
            let border
            height = isOpen ?  '229px' : 0
            border = isOpen ? '1px solid #e0e0e0' : 'none'
            this.timer = setTimeout(() => {
                if(this.isInChild) return
                this.$refs['header-goods-wrapper'].style.height = height
                this.$refs['header-goods-wrapper'].style.border = border
                this.timer = null
            }, 300)
        },
        childEnter() {
            this.isInChild = true
        },
        childLeave() {
            this.isInChild = false
            this._closeOrOpen(false)
        },
        searchFocus() {
            let _this = this
            this.$refs['words-list'].style.display = 'block'
            this.$refs['search-hot-words'].style.opacity = 0
            this.isFocus = true
            this.$refs['search-hot-words'].addEventListener('transitionend', function () {
                let opacity = this.style.opacity;
                if (opacity == 0 && _this.isFocus) {
                    this.style.display = 'none'
                }
            })
        },
        searchBlur() {
            this.$refs['words-list'].style.display = 'none'
            this.$refs['search-hot-words'].style.display = 'block'
            setTimeout(() => {
                this.$refs['search-hot-words'].style.opacity = 1
            }, 10)
        }
    }
})
